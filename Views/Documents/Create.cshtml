@model Doctrack.Models.Document;

@{
  ViewData["Title"] = "Create Document";
}

<h2>Create</h2>
<h3>Document</h3>
<hr />

<form asp-action="Create">
  <div class="form-group">
    <label for="receiptDate" class="control-label">Receipt Date</label>
    <input
      type="text"
      id="receiptDate"
      name="receiptDate"
      class="form-control"
      pattern="[0-9]{2}/[0-9]{2}/[0-9]{4}"
      placeholder="@ViewBag.Today"
      value="@ViewBag.Today"
    />
    <span asp-validation-for="ReceiptDate" class="text-danger">@ViewBag.errorReceiptDate</span>
  </div>

  <div class="form-group">
    <label asp-for="Id" class="control-label">Document No.</label>
    <input asp-for="Id" class="form-control" autocomplete="off" />
    <span asp-validation-for="Id" class="text-danger"></span>
  </div>

  <div class="form-group">
    <label asp-for="DocType_Id" class="control-label">Document Type</label>
    <select asp-for="DocType_Id" class="form-control">
      <option value=0>Select Dcoument Title</option>
      @foreach (var item in @ViewBag.DocTypesTitle)
      {
        <option value=@item.Value>@item.Text</option>
      }
    </select>
    <span asp-validation-for="DocType_Id" class="text-danger"></span>
  </div>

  <div class="form-group">
    <label asp-for="Doc_Title" class="control-label">Document Title</label>
    <input asp-for="Doc_Title" class="form-control" autocomplete="off"/>
    <span asp-validation-for="Doc_Title" class="text-danger"></span>
  </div>

  <input type="hidden" asp-for="Operation" class="form-control" value="กรมแพทย์ทหารบก"/>

  <div class="form-group">
     <label asp-for="CommandOrder" class="control-label">Command Order</label>
     <input asp-for="CommandOrder" class="form-control" autocomplete="off" />
     <span asp-validation-for="CommandOrder" class="text-danger"></span>
  </div>

  <div class="form-group">
    <label asp-for="RemarkAll" class="control-label">Document Remark</label>
    <input asp-for="RemarkAll" class="form-control" autocomplete="off" />
    <span asp-validation-for="RemarkAll" class="text-danger"></span>
  </div>

  <input 
    asp-for="User"
    type="hidden"
    class="form-control"
    value="@ViewBag.currentUser"
  />

  <div class="form-group">
    <input type="submit" value="Create" id="submmit-btn" class="btn btn-primary"/>
  </div>
</form>

<div>
  <a asp-action="Index">Back to List</a>
</div>

<script>
  const form = document.getElementById("create");
  const receiptDate = document.getElementById("ReceiptDate");

  form.addEventListener('submit', (event) => {
    event.preventDefault();
    const receiptValue = receiptDate.value;
    console.log("receiptValue: " + receiptValue);
    const receiptSplit = receiptValue.split("/");
    const receiptFormat = `${receiptSplit[2]}-${receiptSplit[1]}-${receiptSplit[0]}`;
    console.log(receiptFormat);
    receiptDate.value = receiptFormat;
    form.submit();
  });
</script>